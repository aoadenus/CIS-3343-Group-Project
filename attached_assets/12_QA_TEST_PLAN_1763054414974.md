# Emily Bakes Cakes: QA Test Plan and Acceptance Criteria

**Version:** 1.0  
**Last Updated:** November 5, 2025  
**Testing Scope:** Unit, Integration, E2E

---

## Test Strategy

### Testing Pyramid
- **Unit Tests:** 60% (Component logic, utilities, calculations)
- **Integration Tests:** 30% (API + Database interactions)
- **E2E Tests:** 10% (User workflows, critical paths)

### Tools
- **Unit/Integration:** Jest + React Testing Library
- **E2E:** Cypress or Playwright
- **Accessibility:** axe DevTools, WAVE
- **Performance:** Lighthouse, WebPageTest

---

## Unit Test Coverage

### Orders API Tests

\`\`\`javascript
describe('Order Validation', () => {
  test('rejects order with pickup date < 2 days', () => {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    
    const order = { pickupDate: tomorrow };
    const errors = validateOrder(order);
    
    expect(errors).toContainEqual(
      expect.objectContaining({
        field: 'pickupDate',
        message: expect.stringContaining('2 days')
      })
    );
  });

  test('enforces firm price > 0', () => {
    const order = { firmPrice: 0 };
    const errors = validateOrder(order);
    
    expect(errors).toContainEqual(
      expect.objectContaining({ field: 'firmPrice' })
    );
  });

  test('enforces deposit >= 50% of total', () => {
    const order = {
      firmPrice: 100,
      depositAmount: 40 // 40% - too low
    };
    const errors = validateOrder(order);
    
    expect(errors).toContainEqual(
      expect.objectContaining({ field: 'depositAmount' })
    );
  });

  test('allows deposit of exactly 50%', () => {
    const order = {
      firmPrice: 100,
      depositAmount: 50
    };
    const errors = validateOrder(order);
    
    expect(errors).not.toContainEqual(
      expect.objectContaining({ field: 'depositAmount' })
    );
  });

  test('rejects order with > 7 layers', () => {
    const order = {
      layers: Array(8).fill({ layerNumber: 1 })
    };
    const errors = validateOrder(order);
    
    expect(errors).toContainEqual(
      expect.objectContaining({ message: expect.stringContaining('7') })
    );
  });
});
\`\`\`

### Component Tests

\`\`\`javascript
describe('LayerRepeater Component', () => {
  test('renders with minimum 1 layer', () => {
    render(<LayerRepeater layers={[]} onChange={() => {}} />);
    // Button to add layer visible
    expect(screen.getByText(/add layer/i)).toBeInTheDocument();
  });

  test('disables add button when 7 layers added', () => {
    const layers = Array(7).fill({
      layerNumber: 1,
      flavorId: '',
      fillingId: ''
    });
    
    render(
      <LayerRepeater layers={layers} onChange={() => {}} />
    );
    
    const addBtn = screen.getByText(/add layer/i);
    expect(addBtn).toBeDisabled();
  });

  test('prevents deleting last layer', () => {
    const layers = [{ layerNumber: 1, flavorId: '' }];
    const handleChange = jest.fn();
    
    render(
      <LayerRepeater layers={layers} onChange={handleChange} />
    );
    
    const deleteBtn = screen.getByLabelText(/delete layer/i);
    expect(deleteBtn).toBeDisabled();
  });
});
\`\`\`

---

## Integration Tests

### Order Creation Flow

\`\`\`javascript
describe('Order Creation Integration', () => {
  beforeEach(() => {
    // Mock API calls
    jest.spyOn(global, 'fetch');
  });

  afterEach(() => {
    jest.restoreAllMocks();
  });

  test('creates order with all required fields', async () => {
    const mockOrder = {
      orderId: 5001,
      customerId: 42,
      firmPrice: 95,
      status: 'To Be Created'
    };

    fetch.mockResolvedValueOnce({
      ok: true,
      json: async () => mockOrder
    });

    const result = await createOrder({
      customerId: 42,
      productId: 1,
      firmPrice: 95,
      depositAmount: 50,
      layers: [{ layerNumber: 1, flavorId: 1 }],
      pickupDate: '2025-11-15'
    });

    expect(result.orderId).toBe(5001);
    expect(result.status).toBe('To Be Created');
  });

  test('rejects order with invalid customer', async () => {
    fetch.mockResolvedValueOnce({
      ok: false,
      status: 404,
      json: async () => ({ error: 'Customer not found' })
    });

    await expect(
      createOrder({ customerId: 99999, firmPrice: 95 })
    ).rejects.toThrow('Customer not found');
  });

  test('calculates pricing correctly with layer adjustments', async () => {
    const order = {
      cakeSize: { basePrice: 40 },
      layers: [
        { flavorId: 1, extraCost: 0 },
        { flavorId: 4, extraCost: 3 } // Strawberry adds $3
      ]
    };

    const total = calculateOrderTotal(order);
    expect(total).toBe(46); // 40 + 3 + 3 extra
  });
});
\`\`\`

---

## End-to-End (E2E) Tests

### Critical User Paths

\`\`\`javascript
// Cypress test
describe('Create Order - Critical Path', () => {
  beforeEach(() => {
    cy.login('staff@emilybakes.com', 'password123');
    cy.visit('/orders/new');
  });

  it('completes full order creation flow', () => {
    // Step 1: Select Customer
    cy.get('[data-testid="customer-search"]').type('Sarah Johnson');
    cy.get('[data-testid="customer-option-42"]').click();

    // Step 2: Select Product
    cy.get('[data-testid="product-select"]').select('Chocolate Cake');

    // Step 3: Select Size
    cy.get('[data-testid="size-select"]').select('Large');

    // Step 4: Add Layers
    cy.get('[data-testid="add-layer-btn"]').click();
    cy.get('[data-testid="layer-0-flavor"]').select('Chocolate');
    cy.get('[data-testid="layer-0-filling"]').select('Ganache');
    cy.get('[data-testid="layer-0-icing"]').select('Buttercream');
    cy.get('[data-testid="layer-0-color"]').select('White');
    cy.get('[data-testid="layer-0-notes"]').type('Extra filling');

    // Step 5: Set Delivery
    cy.get('[data-testid="pickup-date"]').type('2025-11-15');
    cy.get('[data-testid="pickup-time"]').type('14:00');

    // Step 6: Set Pricing
    cy.get('[data-testid="firm-price"]').clear().type('95.00');
    cy.get('[data-testid="deposit-amount"]').should('have.value', '47.50');

    // Step 7: Submit
    cy.get('[data-testid="submit-btn"]').click();

    // Verify success
    cy.url().should('include', '/orders/');
    cy.contains('Order created successfully').should('be.visible');
  });

  it('prevents order with invalid deposit', () => {
    // ... setup customer and product ...

    cy.get('[data-testid="firm-price"]').type('100.00');
    cy.get('[data-testid="deposit-amount"]').clear().type('40.00'); // Only 40%

    cy.get('[data-testid="submit-btn"]').click();

    cy.contains('Deposit must be at least').should('be.visible');
    cy.url().should('include', '/orders/new');
  });

  it('validates pickup date >= 2 days', () => {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);

    const pickupStr = tomorrow.toISOString().split('T')[0];

    cy.get('[data-testid="pickup-date"]').type(pickupStr);
    cy.get('[data-testid="submit-btn"]').click();

    cy.contains('2 days in advance').should('be.visible');
  });
});
\`\`\`

---

## Accessibility Testing

### Manual Tests

- [ ] Tab through entire form (must reach all elements)
- [ ] Escape key closes modals
- [ ] Screen reader announces all labels and errors
- [ ] Color contrast passes (4.5:1 minimum)
- [ ] Focus indicators visible on all interactive elements
- [ ] Form errors announced as alerts
- [ ] Status messages announced to screen readers

### Automated Tests

\`\`\`javascript
describe('Accessibility', () => {
  it('has no accessibility violations', async () => {
    const results = await axe(document.body);
    expect(results.violations).toHaveLength(0);
  });

  it('has sufficient color contrast', () => {
    const element = screen.getByText('Save Order');
    const computed = window.getComputedStyle(element);
    
    const contrast = getContrastRatio(
      computed.color,
      computed.backgroundColor
    );
    
    expect(contrast).toBeGreaterThanOrEqual(4.5);
  });

  it('form labels associated with inputs', () => {
    const input = screen.getByRole('textbox', { name: /pickup date/i });
    expect(input).toHaveAttribute('id');
    
    const label = document.querySelector(
      `label[for="${input.id}"]`
    );
    expect(label).toBeInTheDocument();
  });
});
\`\`\`

---

## Acceptance Criteria

### Order Creation
- [ ] Staff can create order in <2 minutes
- [ ] All data persists correctly
- [ ] Validation shows clear error messages
- [ ] Price calculation correct with all adjustments
- [ ] Deposit enforces 50% minimum
- [ ] Maximum 7 layers enforced
- [ ] Images upload successfully
- [ ] Confirmation message shows Order ID

### Order Management
- [ ] Manager can view all orders
- [ ] Status can transition: To Be Created → In Baking → Decorating → Ready → Picked Up
- [ ] Status changes persist
- [ ] Production sheet prints correctly
- [ ] All order details visible

### Reporting
- [ ] Revenue calculated correctly
- [ ] Date filtering works (Today, Week, Month, Quarter)
- [ ] Order counts by status accurate
- [ ] Top customers ranking correct
- [ ] Export to PDF/CSV successful

### Security
- [ ] Invalid login rejected
- [ ] JWT token expires in 15 min
- [ ] API requires authentication
- [ ] Rate limiting prevents brute force
- [ ] Staff cannot access other staff's data

### Accessibility
- [ ] Tab navigation works through entire form
- [ ] Screen reader announces all labels
- [ ] Errors announced as alerts
- [ ] Color contrast meets WCAG AA (4.5:1)
- [ ] Focus indicators visible
- [ ] Keyboard-only users can complete order

---

## Performance Benchmarks

- [ ] Page load: <3 seconds
- [ ] Order list render: <1 second (100 orders)
- [ ] New order form load: <1 second
- [ ] API response: <500ms
- [ ] Lighthouse Performance score: ≥85

---

## Browser Compatibility

| Browser | Version | Status |
|---------|---------|--------|
| Chrome | Latest | ✅ Full Support |
| Firefox | Latest | ✅ Full Support |
| Safari | Latest | ✅ Full Support |
| Edge | Latest | ✅ Full Support |
| Mobile Chrome | Latest | ✅ Full Support |
| Mobile Safari | Latest | ✅ Full Support |

---

## Test Execution Checklist

**Before Demo:**
- [ ] All unit tests passing (npm test)
- [ ] All integration tests passing
- [ ] E2E critical path passing
- [ ] No accessibility violations (axe scan)
- [ ] Lighthouse score ≥85
- [ ] No console errors
- [ ] Password handling verified
- [ ] API auth verified

**Demo Script for Professor:**
1. Login with valid credentials
2. Search for existing customer
3. Create new order with all details
4. Add 3 layers with different options
5. Upload image for Layer 1
6. Set pickup date 3+ days advance
7. Enter firm price ($95)
8. Enter deposit ($50 - exactly 50%)
9. Review order details
10. Submit order
11. View order in list with correct status
12. Update status to "In Baking"
13. View manager reports filtered by date
14. Verify revenue total
15. Print production sheet

---

## Related Documents

- **01_SCOPE_AND_NON_GOALS.md** - Acceptance criteria source
- **09_FRONTEND_IMPLEMENTATION.md** - Test implementation
- **11_SECURITY_AND_COMPLIANCE.md** - Security tests

---

**Status:** Production Ready  
**Last Updated:** November 5, 2025
